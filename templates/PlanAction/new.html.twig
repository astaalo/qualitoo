{% extends 'configuration/index.html.twig' %}
{% form_theme form 'OrangeMainBundle:Extra:simple_form_theme.html.twig' %}
{% form_theme form 'OrangeMainBundle:Extra:simple_form_theme.html.twig' %}

{% block menu_config %}
	{% include 'configuration/maitrise.html.twig' with {position: 1} %}
{% endblock %}

{% block header_config %}
<div class="header">
	<span>
		<span class="ico color add"></span>Ajout d'un plan d'action
	</span>
	<div id="buttom_top">
		<ul class="uibutton-group">
		{% if entity.risque is not empty and entity.risque.isValidated %}
			{% if risque_id is not empty %}
				<li><a class="uibutton icon answer" href="{{ path('details_risque', {id: risque_id}) }}">Retour au risque</a></li>
			{% endif %}
				<li><a class="uibutton icon answer" href="{{ path('les_planactions') }}">Liste des plans d'action</a></li>
        {% endif %}
		{% if entity.risque is not empty and (entity.risque.isIdentified or entity.risque.isPending) %}
				{% if entity.risque.evaluation|length %}
					<li><a class="uibutton icon special forward" href="{{ path('edition_evaluation', {id: entity.risque.evaluation.0.id}) }}">Passer à l'évaluation</a></li>
				{% else %}
					<li><a class="uibutton icon special forward" href="{{ path('nouvelle_evaluation', {id: entity.risque.id}) }}">Passer à l'évaluation</a></li>
				{% endif %}
		{% endif %}
        </ul>
    </div>
</div>
{% endblock %}

{% block content_config %}
<div class="one_column">
	<div class="contentForm">
		<form novalidate="novalidate" action="{{ path('creer_planaction') }}" method="POST">
			{{ form_row(form.libelle, {attr: {class: 'full'}}) }}
			{{ form_widget(form.controle) }}
			{{ form_row(form.risque) }}
			{{ form_row(form.causeOfRisque) }}
			{{ form_row(form.dateDebut, {attr: {'class': 'datepicker '}}) }}
			{{ form_row(form.dateFin, {attr: {'class': 'datepicker '}}) }}
			{{ form_row(form.porteur) }}
			{{ form_row(form.superviseur) }}
			{{ form_row(form.statut) }}
			{{ form_row(form.description, {attr: {class: 'full'}}) }}
			{{ form_row(form._token) }}
			<div class="section last footer">
				<div>
				{% if entity.risque is empty or entity.risque.isValidated %}
					<button name="save" class="uibutton loading">Enregistrer</button>
				{% else %}
					<button name="add_another" class="uibutton loading">Enregistrer et passer à un autre plan d'action</button>
					<button name="add_and_pass" class="uibutton loading">Enregistrer et passer à l'évaluation</button>
				{% endif %}
				</div>
			</div>
		</form>
	</div>
</div>
{% endblock %}
