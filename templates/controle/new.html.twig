{% extends "base.html.twig" %}
{% form_theme form 'extra/simple_form_theme.html.twig' %}

{% block navigation %}
	{{ knp_menu_render('OrangeMainBundle:Builder:showMenu', {'template': 'extra/knp_menu.html.twig', 'item': {1:'Configuration'} }) }}
{% endblock %}

{% block content %}
<div class="onecolumn">
	<div class="header">
		<span>
			<span class="ico color add"></span>
			Ajout Contrôle
		</span>
		<div id="buttom_top">
			<ul class="uibutton-group">
			{% if entity.risque is not empty and entity.risque.isValidated %}
				<li><a class="uibutton icon answer" href="{{ path('details_risque', {id: entity.risque.id}) }}">Retour au risque</a></li>
				<li><a class="uibutton icon answer" href="{{ path('les_controles') }}">Liste des controles</a></li>
			{% endif %}
			{% if entity.risque is not empty and (entity.risque.isIdentified or entity.risque.isPending) %}
				{% if entity.risque.planAction|length %}
					<li><a class="uibutton icon special forward" href="{{ path('edition_planaction', {id: entity.risque.planAction.0.id}) }}">Passer aux plans d'action</a></li>
				{% else %}
					<li><a class="uibutton icon special forward" href="{{ path('nouveau_planaction_de_risque', {risque_id: entity.risque.id}) }}">Passer aux plans d'action</a></li>
				{% endif %}
			{% endif %}
            </ul>
        </div>
	</div>
	<div class="clear"></div>
	<div class="contentForm">
	<form  novalidate="novalidate"  action="{{ path('creer_controle') }}" method="POST">
{# 		{{ form_row(form.libelle, {attr:{class: 'full'}}) }}#}
        {{ form_row(form.description)}}
		{{ form_row(form.planAction) }}
		{{ form_row(form.risque) }}
		{{ form_row(form.causeOfRisque) }}
		{{ form_row(form.methodeControle) }}
		{{ form_row(form.typeControle) }}
		{% if  entity.risque.isPhysical %}
		    {{ form_row(form.grille) }}
		{% endif %}
		{{ form_row(form.traitement) }}
		{{ form_row(form.periodicite) }}
		{{ form_row(form.porteur) }}
		{{ form_row(form.superviseur) }}
		{{ form_row(form.url) }}
		{{ form_row(form.aTester)}}
		{{ form_row(form._token) }}
		<div class="section last footer">
			<div>
			{% if entity.risque is empty or entity.risque.isValidated %}
				<button name="save" class="uibutton loading">Enregistrer</button>
			{% else %}
				<button name="add_another" class="uibutton loading">Enregistrer et passer à un autre contrôle</button>
				<button name="add_and_pass" class="uibutton loading">Enregistrer et passer aux plans d'actions</button>
			{% endif %}
			</div>
		</div>
	</form>
	</div>
</div>
{% endblock %}
{% block add_script_js %}
{% if  entity.risque.isPhysical %}
    {% include 'extra/reloadSelect.html.twig' with 
    			{parent: form.causeOfRisque, child: form.grille, url: path('grille_by_carto'), key: 'id', functionAfter: 'refreshChosen' } 
    %}
{% endif %}
{% endblock %}
