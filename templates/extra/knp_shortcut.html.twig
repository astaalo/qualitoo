{% extends 'knp_menu.html.twig' %}

{% macro attributes(attributes) %}
{% for name, value in attributes %}
    {%- if value is not none and value is not same as(false) -%}
        {{- ' %s="%s"'|format(name, value is same as(true) ? name|e : value|e)|raw -}}
    {%- endif -%}
{%- endfor -%}
{% endmacro %}

{% block item %}
{% if item.displayed %}
{# building the class of the item #}
    {%- set classes = item.attribute('class') is not empty ? [item.attribute('class')] : [] %}
    {%- set activeClass = ((options.item[item.getLevel] is defined) and (options.item[item.getLevel]==item.name)) ? 'select' : null %}
    {%- set attributes = item.attributes %}
    {%- if classes is not empty %}
        {%- set attributes = attributes|merge({'class': classes|join(' ')}) %}
    {%- endif %}
{# displaying the item #}
    <li class="{{ activeClass }}">
        {{ block('linkElement') }}
{# render the list of children#}
        {%- set childrenClasses = item.childrenAttribute('class') is not empty ? [item.childrenAttribute('class')] : [] %}
        {%- set listAttributes = item.childrenAttributes|merge({'class': childrenClasses|join(' ') }) %}
        {{ block('list') }}
    </li>
{% endif %}
{% endblock %}

{% block linkElement %}
	{%- if item.getLevel > 1 %}
		<a href="{{ item.uri }}"{{ _self.attributes(item.linkAttributes) }}><i class="{{ item.attribute('class') }}"></i>
			{{ block('label') }}
			<span>{{ item.attribute('description') }}</span>
		</a>
		
	{%- else %}
		<a {% if item.attribute('href_attr') is not empty %}id="{{ item.attribute('href_attr').id }}" class="{{ item.attribute('href_attr').class }}"{% endif %} href="{{ item.uri }}"{{ _self.attributes(item.linkAttributes) }}>
			<img src="{{ asset('assets/bundles/orangemain/images/icon/' ~ item.attribute('icon')) }}" alt="{{ block('label') }}" width="40px" />
			<strong>{{ block('label') }}</strong>
			{% if item.attribute('has_notifications') %}
				<div class="notification" >{{ item.attribute('notifications_count') }}</div>
			{% endif %}
		</a>
    {%- endif %}
{% endblock %}